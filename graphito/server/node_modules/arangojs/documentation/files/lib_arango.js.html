<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/arango.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/action.html">action</a></li>
            
                <li><a href="../classes/admin.html">admin</a></li>
            
                <li><a href="../classes/aqlfunction.html">aqlfunction</a></li>
            
                <li><a href="../classes/arango.html">arango</a></li>
            
                <li><a href="../classes/batch.html">batch</a></li>
            
                <li><a href="../classes/collection.html">collection</a></li>
            
                <li><a href="../classes/cursor.html">cursor</a></li>
            
                <li><a href="../classes/database.html">database</a></li>
            
                <li><a href="../classes/document.html">document</a></li>
            
                <li><a href="../classes/edge.html">edge</a></li>
            
                <li><a href="../classes/endpoint.html">endpoint</a></li>
            
                <li><a href="../classes/graph.html">graph</a></li>
            
                <li><a href="../classes/import.html">import</a></li>
            
                <li><a href="../classes/index.html">index</a></li>
            
                <li><a href="../classes/jobs.html">jobs</a></li>
            
                <li><a href="../classes/query.html">query</a></li>
            
                <li><a href="../classes/simple.html">simple</a></li>
            
                <li><a href="../classes/transaction.html">transaction</a></li>
            
                <li><a href="../classes/traversal.html">traversal</a></li>
            
                <li><a href="../classes/users.html">users</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/action.html">action</a></li>
            
                <li><a href="../modules/admin.html">admin</a></li>
            
                <li><a href="../modules/aqlfunction.html">aqlfunction</a></li>
            
                <li><a href="../modules/arango.html">arango</a></li>
            
                <li><a href="../modules/batch.html">batch</a></li>
            
                <li><a href="../modules/collection.html">collection</a></li>
            
                <li><a href="../modules/cursor.html">cursor</a></li>
            
                <li><a href="../modules/database.html">database</a></li>
            
                <li><a href="../modules/document.html">document</a></li>
            
                <li><a href="../modules/edge.html">edge</a></li>
            
                <li><a href="../modules/endpoint.html">endpoint</a></li>
            
                <li><a href="../modules/graph.html">graph</a></li>
            
                <li><a href="../modules/import.html">import</a></li>
            
                <li><a href="../modules/index.html">index</a></li>
            
                <li><a href="../modules/jobs.html">jobs</a></li>
            
                <li><a href="../modules/query.html">query</a></li>
            
                <li><a href="../modules/simple.html">simple</a></li>
            
                <li><a href="../modules/transaction.html">transaction</a></li>
            
                <li><a href="../modules/traversal.html">traversal</a></li>
            
                <li><a href="../modules/users.html">users</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/arango.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;;

var url = require(&#x27;./url&#x27;),
    base64 = require(&#x27;base64&#x27;),
    Promise = require(&#x27;micropromise&#x27;),
    utils = require(&#x27;./utils&#x27;),
    request = require(&#x27;./request&#x27;);

var API_DIR = &#x27;./api/&#x27;,
    API_MODULES = [
        &#x27;transaction&#x27;,
        &#x27;collection&#x27;,
        &#x27;database&#x27;,
        &#x27;document&#x27;,
        &#x27;cursor&#x27;,
        &#x27;job&#x27;,
        &#x27;simple&#x27;,
        &#x27;index&#x27;,
        &#x27;query&#x27;,
        &#x27;admin&#x27;,
        &#x27;aqlfunction&#x27;,
        &#x27;endpoint&#x27;,
        &#x27;import&#x27;,
        &#x27;traversal&#x27;,
        &#x27;graph&#x27;,
        &#x27;batch&#x27;,
        &#x27;edge&#x27;,
        &#x27;action&#x27;,
        &#x27;user&#x27;
    ],
    ArangoAPI;


function Arango(db, options) {
    if (!(this instanceof Arango)) {
        return new Arango(db, options);
    }

    /* attach API:s */
    attach(this, ArangoAPI);

    if (db instanceof Arango) {
        this._name = db._name;
        this._collection = db._collection;
        this._server = utils.extend(true, {}, db._server);
    } else options = db;

    if (options) {
        if (typeof options === &#x27;string&#x27;) {
            utils.extend(true, this, url.path2db(options));
        } else if (typeof options === &#x27;object&#x27;) {
            if (options.api) attach(this, options.api);
            if (options._name) this._name = options._name;
            if (options._server) this._server = options._server;
            if (options._collection) this._collection = options._collection;
        }
    }
    /* Apply defaults */
    if (typeof this._server !== &#x27;object&#x27;)
        this._server = {};
    if (typeof this._server.protocol !== &#x27;string&#x27;)
        this._server.protocol = &#x27;http&#x27;;
    if (typeof this._server.hostname !== &#x27;string&#x27;)
        this._server.hostname = &#x27;127.0.0.1&#x27;;
    if (typeof this._server.port !== &#x27;number&#x27;)
        this._server.port = parseInt(this._server.port || 8529, 10);
    if (typeof this._collection !== &#x27;string&#x27;)
        this._collection = &#x27;&#x27;;

    /* Basic authorization */
    if (this._server.username) {
        if (typeof this._server.headers !== &#x27;object&#x27;) this._server.headers = {};
        this._server.headers[&#x27;authorization&#x27;] = &#x27;Basic &#x27; +
            base64.encode(this._server.username + &#x27;:&#x27; + this._server.password);
    }
}
/**
 * Creates an arango connection, can be called either with a JSON Object representing the connection or with a
 * connection String.
 *
 * @example
 *  arango.Connection(&quot;https://user:pass@hostname:8529/database:collection&quot;)&lt;br&gt;
 *  arango.Connection(&quot;https://test.com&quot;)&lt;br&gt;
 *  arango.Connection({_name:&quot;database&quot;,_collection:&quot;collection&quot;,_server:{hostname:&quot;test.host&quot;}})&lt;br&gt;
 *
 * @return {arango}
 * @class arango
 * @constructor
 * @module arango

 */
Arango.Connection = function() {
    var options = {};

    for (var i = 0; arguments[i]; i++) {
        if (typeof arguments[i] === &#x27;object&#x27;)
            utils.extend(true, options, arguments[i]);
        else if (typeof arguments[i] === &#x27;string&#x27;)
            utils.extend(true, options, url.path2db(arguments[i]));
    }

    return new Arango(options);
}

/* api registration hook */
Arango.api = function(ns, exp) {
    var api = {};

    api[ns] = exp;

    attach(this, api);

    return exp;
}

/* base64 helper */
Arango.base64 = base64;

Arango.prototype = {
    /**
     * changes the arango connection
     *
     * @param {String|Object} options - the new connection parameters.
     * @method use
     * @return{arango}
     */
    &quot;use&quot;: function(options) {
        return new Arango(this, options);
    },
    /**
     * changes the arango defautl collection
     *
     * @param {String} collection - the collection to be used for all further requests.
     * @method useCollection
     * @return{arango}
     */
    &quot;useCollection&quot;: function(collection) {
        return this.use(&quot;:&quot; + collection);
    },
    /**
     * changes the arango database.
     *
     * @param {String} database - the database to perform every operation on.
     * @method useDatabase
     * @return{arango}
     */
    &quot;useDatabase&quot;: function(database) {
        return this.use(&quot;/&quot; + database);
    },
    /**
     * add a new api module to the arango module
     *
     * @param {Object} api - a new api module
     * @method api
     * @return{arango}
     */
    &quot;api&quot;: function(api) {
        if (!api) return ArangoAPI;

        attach(this, api);

        return new Arango(this);
    },
    /**
     * perform a HTTP &quot;GET&quot; request
     *
     * @param {String} path - the URL
     * @param {Object} options - a  JSON Object containing optional data.
     * @param {Function} callback   - The callback function.
     * @method get
     * @return{Promise}
     */
    &quot;get&quot;: function(path, options, callback) {
        return this.request(&#x27;GET&#x27;, path, null, options, callback);
    },
    /**
     * perform a HTTP &quot;POST&quot; request
     *
     * @param {String} path - the URL
     * @param {Object} options - a  JSON Object containing optional data.
     * @param {Object} data - the request body
     * @param {Function} callback   - The callback function.
     * @method post
     * @return{Promise}
     */
    &quot;post&quot;: function(path, data, options, callback) {
        return this.request(&#x27;POST&#x27;, path, data, options, callback);
    },
    /**
     * perform a HTTP &quot;PUT&quot; request
     *
     * @param {String} path - the URL
     * @param {Object} options - a  JSON Object containing optional data.
     * @param {Object} data - the request body
     * @param {Function} callback   - The callback function.
     * @method put
     * @return{Promise}
     */
    &quot;put&quot;: function(path, data, options, callback) {
        return this.request(&#x27;PUT&#x27;, path, data, options, callback);
    },
    /**
     * perform a HTTP &quot;DELETE&quot; request
     *
     * @param {String} path - the URL
     * @param {Object} options - a  JSON Object containing optional data.
     * @param {Function} callback   - The callback function.
     * @method delete
     * @return{Promise}
     */
    &quot;delete&quot;: function(path, options, callback) {
        return this.request(&#x27;DELETE&#x27;, path, null, options, callback);
    },
    /**
     * perform a HTTP &quot;HEAD&quot; request
     *
     * @param {String} path - the URL
     * @param {Object} options - a  JSON Object containing optional data.
     * @param {Function} callback   - The callback function.
     * @method head
     * @return{Promise}
     */
    &quot;head&quot;: function(path, options, callback) {
        return this.request(&#x27;HEAD&#x27;, path, null, options, callback);
    },
    /**
     * perform a HTTP &quot;PATCH&quot; request
     *
     * @param {String} path - the URL
     * @param {Object} options - a  JSON Object containing optional data.
     * @param {Object} data - the request body
     * @param {Function} callback   - The callback function.
     * @method patch
     * @return{Promise}
     */
    &quot;patch&quot;: function(path, data, options, callback) {
        return this.request(&#x27;PATCH&#x27;, path, data, options, callback);
    },
    /**
     * perform a HTTP &quot;OPTIONS&quot; request
     *
     * @param {String} path - the URL
     * @param {Object} options - a  JSON Object containing optional data.
     * @param {Function} callback   - The callback function.
     * @method options
     * @return{Promise}
     */
    &quot;options&quot;: function(path, options, callback) {
        return this.request(&quot;OPTIONS&quot;, path, null, options, callback);
    },
    /**
     * Enables/disables the async mode. Every request is enriched with a header telling arangodb to perform the request
     * asnyc.
     *
     * @param {Boolean} active   -  true to activate.
     * @param {Boolean} [fireAndForget   -  if true fire and forget mode is activated.
     * @method setAsyncMode
     * @return{arango}
     */
    &quot;setAsyncMode&quot;: function(active, fireAndForget) {

        if (!active) {
            if (this._server.headers !== undefined)
                delete this._server.headers[&quot;x-arango-async&quot;];

            return this;
        }

        if (typeof this._server.headers !== &#x27;object&#x27;)
            this._server.headers = {};

        this._server.headers[&quot;x-arango-async&quot;] = fireAndForget ? &quot;true&quot; : &quot;store&quot;;

        return this;
    },

    &quot;debug&quot;: function(on) {
        if (on === undefined) return debug;

        debug = !! on;
    },
    &quot;request&quot;: request,
    &quot;Promise&quot;: Promise
}

function attach(db, api) {
    if (typeof api === &#x27;string&#x27;) {
        api = fetch(api);
    }

    for (var ns in api) {
        if (!Object.getOwnPropertyDescriptor(db, ns))
            load(db, ns, api[ns], true);
    }
}

function load(db, ns, api, lazy) {

    if (lazy) {
        Object.defineProperty(db, ns, {
            enumerable: true,
            configurable: true,
            get: function() {
                return context();
            }
        });
    } else {
        db[ns] = typeof api === &#x27;function&#x27; ? api(db) : context();
    }

    function context() {
        var instance = (require(api))(db);

        context = function() {
            return instance
        };

        return instance;
    }
}

function fetch(api) {
    var o = {};

    if (typeof api === &#x27;string&#x27;) api = api.split(&#x27; &#x27;);

    for (var n in api) o[api[n]] = API_DIR + api[n];

    return o;
}

/* configure API modules */
ArangoAPI = fetch(API_MODULES);

module.exports = Arango;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
